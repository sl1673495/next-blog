<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/ivJUyKh6Uwyov90KnhDy1/pages/383707716.js" as="script"/><link rel="preload" href="/_next/static/ivJUyKh6Uwyov90KnhDy1/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/chunks/42.804f640b9080257d2001.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c213b3d658f42fde6232.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.59358844195a85e5278d.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-b7de933161803ebe9106.js" as="script"/><link rel="stylesheet" href="/_next/static/css/commons.8b6757c5.chunk.css"/></head><body><div id="__next"><div style="max-width:1000px;margin:auto;padding:20px"><div><h1 class="title"><a href="/">ssh的前端博客</a></h1></div><h1>关于如何触发浏览器重绘的一些尝试。</h1><div><p>我们动态的往body节点上挂一个小球 并且更改它的top值 让它触发动画<br>（以下代码均在chrome控制台执行）</p>
<pre><code class="language-js">var div = document.createElement(&#39;div&#39;)
div.style.cssText = &#39;position: fixed;width: 30px; height: 30px; left: 0; top: 0; background: red;transition: all 1s&#39;
document.body.appendChild(div)
div.style.top = &#39;500px&#39;</code></pre>
<p>这样写是没用的，因为浏览器很聪明，它会把你在一次task中的样式更改收集起来，再执行渲染的时候再把它一次性改变，但是网上很多人说getComputedStyle这个api可以直接触发重绘，那么我们来试试</p>
<pre><code class="language-js">var div = document.createElement(&#39;div&#39;)
div.style.cssText = &#39;position: fixed;width: 30px; height: 30px; left: 0; top: 0; background: red;transition: all 1s&#39;
document.body.appendChild(div)

// 想触发重绘
getComputedStyle(div)
div.style.top = &#39;500px&#39;</code></pre>
<p>按理说应该会执行动画吧， 可是并没有，这很让人疑惑，我们再这样试试</p>
<pre><code class="language-js">var div = document.createElement(&#39;div&#39;)
div.style.cssText = &#39;position: fixed;width: 30px; height: 30px; left: 0; top: 0; background: red;transition: all 1s&#39;
document.body.appendChild(div)

// 想触发重绘
getComputedStyle(div).top
div.style.top = &#39;500px&#39;</code></pre>
<p>咦，这次终于执行动画了，看来浏览器优化程度到了这一步，就算你去getComputedStyle 它也会惰性的给你返回一个对象， 等到你真正的去读取里面的样式值，才会触发重绘。</p>
<p>再来一个小实验，我们想要让浏览器闪烁两个颜色</p>
<pre><code class="language-js">document.body.style.background = &#39;blue&#39;
document.body.style.background = &#39;red&#39;</code></pre>
<p>显而易见这样是没用的， 那么我们用setTimeout去让中间经历一次浏览器渲染</p>
<pre><code class="language-js">document.body.style.background = &#39;blue&#39;
setTimeout(() =&gt; { document.body.style.background = &#39;red&#39; })</code></pre>
<p>这次好像可以了 把这段代码在浏览器里执行多次， 会发现有时候还是会直接变成红色背景，这是为什么呢？ 我们继续做个试验</p>
<pre><code class="language-js">document.body.style.background = &#39;blue&#39;
setTimeout(() =&gt; { document.body.style.background = &#39;red&#39; }, 16.7)</code></pre>
<p>这段代码再执行n次， 这下每次都会闪烁两种颜色了， 16.7是个什么数字呢，我们一般电脑的屏幕刷新率是60hz，也就是每秒更新60次视图，1000ms / 60 ≈ 16.7 浏览器会根据你的屏幕刷新率去约束渲染线程的执行，去除掉多余无效的渲染。</p>
<p>那牵扯到硬件，假如我们的刷新率只有30hz呢， 或者更多，更少呢？<br>这也就是为什么浏览器给我们提供了一个api叫requestAnimationFrame，不懂的朋友们可以去查阅一下这个api的用法。<br>真正保证屏幕一定会闪烁两次的做法</p>
<pre><code class="language-js">requestAnimationFrame(() =&gt; {
  document.body.style.background = &#39;red&#39; 
  requestAnimationFrame(() =&gt; {
    document.body.style.background = &#39;blue&#39;
  })
})</code></pre>
</div></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/383707716","query":{},"buildId":"ivJUyKh6Uwyov90KnhDy1","nextExport":true,"dynamicIds":["+FGM","+fC4","0kiY","1LUk","28xz","2Vkh","3EHr","3gkP","3wag","4Q+X","4qfg","5VxD","5upZ","6ZBy","6k3J","6quq","73oX","75kF","7P7d","7mzT","7oys","8Kqh","8Pgg","8SK+","9Fqr","9G73","9JLW","9Mhc","9Nr/","9Q8I","9U8A","9c9R","9xzc","AIHI","Aayt","Agkw","AhXs","ApBa","Aqyh","AsRY","B05S","BIHe","BKhn","BLBw","BrQc","CyL5","D68y","DxbC","DzyG","E2cJ","EGmf","FIf5","FJ32","G+vv","G01c","GEZ5","GTAt","GgYO","GwJY","Gxxu","H2RM","H4p3","ImXp","JCUK","JGhL","Jb18","Jjkb","JopO","Jrxr","KK3C","KQfT","KUpP","KcjC","Kjk6","KpOm","KyKy","LOdI","LhHj","Ll1m","Lns6","Lo5G","LptB","MF4s","MQ8/","My+Z","NRrW","NyhX","OZ3z","PGlF","PziN","Q5ZB","QPTg","QQjU","QnJG","RLXu","ROUN","Rq6a","SF9x","SLii","Sl5E","T0rU","TdF3","UCcd","UFGb","UI5O","Uasv","VrLj","WSH0","Wj43","WtIr","Xfvt","YROV","YSo5","ZrqW","alHH","beiO","d4EH","ddo8","dnrZ","dycj","e8E9","ebWy","el66","fDA8","fEaW","fHEK","fP8y","fZ2E","gLO8","gmEm","gst6","hmeD","iTGd","ieeH","iobV","irpp","jKVu","jU8F","jW1C","jctj","kZ3Q","lE5/","lKKg","lRCX","lURu","ldBm","m/If","mBTZ","mY11","mzJY","n3/M","nwyE","o0In","oKc0","oU5B","oVRe","oVqn","on2m","ozyK","phP4","pvv5","pw5m","pxCe","qIW7","qUGr","qZUF","r0Rl","r7oX","rfnV","rnof","s8Vx","sM9k","sbla","syIQ","t6qC","tSgA","tluB","u0OR","u2N3","u34i","uIR8","uQpx","uR4j","unZW","vYiF","wB1n","wi1Z","xj1T","yOV0"]}</script><script async="" data-next-page="/383707716" src="/_next/static/ivJUyKh6Uwyov90KnhDy1/pages/383707716.js"></script><script async="" data-next-page="/_app" src="/_next/static/ivJUyKh6Uwyov90KnhDy1/pages/_app.js"></script><script async="" src="/_next/static/chunks/42.804f640b9080257d2001.js"></script><script src="/_next/static/runtime/webpack-c213b3d658f42fde6232.js" async=""></script><script src="/_next/static/chunks/commons.59358844195a85e5278d.js" async=""></script><script src="/_next/static/runtime/main-b7de933161803ebe9106.js" async=""></script></body></html>